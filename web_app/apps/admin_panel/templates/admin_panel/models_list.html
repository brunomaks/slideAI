{% extends 'admin_panel/base.html' %}

{% block title %}Model Versions{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>Model Versions</h1>
</div>

{% if models %}
<div class="card">
    <table>
        <thead>
            <tr>
                <th>Version ID</th>
                <th>Status</th>
                <th>Test Accuracy</th>
                <th>Trained</th>
                <th>Epochs</th>
                <th>Dataset Size</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for model in models %}
            <tr>
                <td>
                    <strong>{{ model.version_id }}</strong>
                    {% if model.is_active %}
                    <span class="badge badge-success" style="margin-left: 0.5rem;">ACTIVE</span>
                    {% endif %}
                </td>
                <td>
                    {% if model.is_active %}
                    <span class="badge badge-success">Deployed</span>
                    {% else %}
                    <span class="badge badge-secondary">Inactive</span>
                    {% endif %}
                </td>
                <td><strong>{{ model.test_accuracy|floatformat:2 }}%</strong></td>
                <td>{{ model.training_date|date:"Y-m-d H:i" }}</td>
                <td>{{ model.epochs }}</td>
                <td>{{ model.train_dataset_size }}</td>
                <td>
                    <a href="{% url 'admin_panel:model_detail' model.id %}" class="btn btn-primary"
                        style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">View</a>
                    {% if not model.is_active %}
                    <a href="{% url 'admin_panel:deploy_model' model.id %}" class="btn btn-success"
                        style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Deploy</a>
                    {% else %}
                    <span class="badge badge-info">Current</span>
                    {% endif %}
                    
                    {% if not model.is_active %}
                    <form action="{% url 'admin_panel:delete_model' model.id %}" method="post" style="display: inline-block; margin-left: 0.5rem;" onsubmit="return confirm('Are you sure you want to delete this model? This cannot be undone.');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; background-color: #dc3545; border-color: #dc3545; color: white;">Delete</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div style="margin-top: 1rem;">
        <a href="{% url 'admin_panel:compare_models' %}" class="btn btn-primary">Compare Models</a>
    </div>
</div>
{% else %}
<div class="card">
    <p>No models found. <a href="{% url 'admin_panel:start_training' %}">Train your first model</a>.</p>
</div>
{% endif %}
{% endblock %}